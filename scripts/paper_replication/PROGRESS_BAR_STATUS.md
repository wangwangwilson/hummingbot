# 进度条功能说明

## ✅ 已实现

### 进度条显示
- 使用`tqdm`库显示进度条
- 显示信息：
  - 当前进度百分比
  - 已处理/总行数
  - 已用时间
  - 预计剩余时间
  - 处理速度（行/秒）

### 回测性能
- **当前速度**: 约17-18行/秒
- **数据量**: 447,348行
- **预计总时间**: 约7小时（44万行 ÷ 17行/秒）

### 性能分析
回测速度较慢的原因：
1. **逐行处理**: 每行K线都需要：
   - `update_state()` - 更新状态
   - `determine_executor_actions()` - 计算策略动作
   - `simulate_executor()` - 模拟executor（如果创建了新的）
2. **策略逻辑**: PMM Bar Portion需要：
   - 计算Bar Portion
   - 训练线性回归模型
   - 预测价格
   - 计算价差

## 📊 当前进度

从日志可以看到进度条正在工作：
```
回测进度:   0%|          | 316/447348 [00:18<6:51:12, 18.12行/s]
```

- 已处理: 316行
- 总行数: 447,348行
- 已用时间: 18秒
- 预计剩余: 6小时51分
- 处理速度: 18.12行/秒

## 💡 优化建议

如果需要加速回测，可以考虑：
1. **减少数据量**: 使用更短的时间范围（如1个月）
2. **降低精度**: 使用更大的K线间隔（如5分钟而不是1分钟）
3. **并行处理**: 将数据分段并行处理（需要修改回测引擎）

## 📝 使用说明

进度条已自动启用，在`test_btc_backtest_analysis.py`中：
```python
results = await engine.run_backtesting(
    ...
    show_progress=True  # 启用进度条
)
```

进度条会实时显示在stderr，不影响正常的日志输出。

